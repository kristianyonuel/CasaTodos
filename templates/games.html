{% extends "base.html" %}

{% block title %}Make Picks - La Casa de Todos{% endblock %}

{% block content %}
<div class="games-container">
    <!-- Dashboard Section -->
    <div class="dashboard-section">
        <div class="welcome-header">
            <h2>Make Your Picks - Week {{ current_week }} 🏈</h2>
            <p>Hi {{ username }}! Ready to make your selections?</p>
        </div>
        
        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-label">Current Week</div>
                <div class="stat-value">{{ current_week }}</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Your Progress</div>
                <div class="stat-value">{{ user_picks_count }}/{{ total_games }}</div>
                <div class="stat-subtitle">
                    {% if total_games and user_picks_count %}
                        {{ "%.0f"|format((user_picks_count / total_games * 100)) }}% Complete
                    {% else %}
                        Ready to pick
                    {% endif %}
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Your Wins</div>
                <div class="stat-value">{{ user_wins or 0 }}</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Total Players</div>
                <div class="stat-value">{{ total_players or 0 }}</div>
            </div>
        </div>

        <!-- Progress Bar -->
        {% if total_games > 0 %}
        <div class="progress-section">
            <div class="progress-info">
                <span>Your picks: {{ user_picks_count }}/{{ total_games }} games</span>
                <span>{{ "%.0f"|format((user_picks_count / total_games * 100)) if total_games > 0 else 0 }}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ (user_picks_count / total_games * 100) if total_games > 0 else 0 }}%"></div>
            </div>
        </div>
        {% endif %}

        <!-- Deadline Information -->
        {% if deadline_summary %}
        <div class="deadline-summary">
            <h3>⏰ Deadlines (AST)</h3>
            <div class="deadline-cards">
                {% if deadline_summary.thursday %}
                <div class="deadline-card {% if deadline_summary.thursday.passed %}passed{% elif deadline_summary.thursday.urgency == 'critical' %}critical{% elif deadline_summary.thursday.urgency == 'warning' %}warning{% endif %}">
                    <div class="deadline-type">Thursday Night</div>
                    <div class="deadline-time">{{ deadline_summary.thursday.formatted_time }}</div>
                    {% if deadline_summary.thursday.passed %}
                        <div class="deadline-status">Deadline Passed</div>
                    {% elif deadline_summary.thursday.hours_remaining <= 24 %}
                        <div class="deadline-status">{{ deadline_summary.thursday.hours_remaining|round(1) }}h left</div>
                    {% endif %}
                    {% if deadline_summary.thursday.matchup %}
                        <div class="deadline-matchup">{{ deadline_summary.thursday.matchup }}</div>
                    {% endif %}
                </div>
                {% endif %}
                
                {% if deadline_summary.sunday %}
                <div class="deadline-card {% if deadline_summary.sunday.passed %}passed{% elif deadline_summary.sunday.urgency == 'critical' %}critical{% elif deadline_summary.sunday.urgency == 'warning' %}warning{% endif %}">
                    <div class="deadline-type">Sunday Games</div>
                    <div class="deadline-time">{{ deadline_summary.sunday.formatted_time }}</div>
                    {% if deadline_summary.sunday.passed %}
                        <div class="deadline-status">Deadline Passed</div>
                    {% elif deadline_summary.sunday.hours_remaining <= 24 %}
                        <div class="deadline-status">{{ deadline_summary.sunday.hours_remaining|round(1) }}h left</div>
                    {% endif %}
                </div>
                {% endif %}
                
                {% if deadline_summary.monday %}
                <div class="deadline-card {% if deadline_summary.monday.passed %}passed{% elif deadline_summary.monday.urgency == 'critical' %}critical{% elif deadline_summary.monday.urgency == 'warning' %}warning{% endif %}">
                    <div class="deadline-type">Monday Night</div>
                    <div class="deadline-time">{{ deadline_summary.monday.formatted_time }}</div>
                    <div class="deadline-note">Score prediction required</div>
                    {% if deadline_summary.monday.passed %}
                        <div class="deadline-status">Deadline Passed</div>
                    {% elif deadline_summary.monday.hours_remaining <= 24 %}
                        <div class="deadline-status">{{ deadline_summary.monday.hours_remaining|round(1) }}h left</div>
                    {% endif %}
                    {% if deadline_summary.monday.matchup %}
                        <div class="deadline-matchup">{{ deadline_summary.monday.matchup }}</div>
                    {% endif %}
                </div>
                {% endif %}
                
                {% if deadline_summary.next_deadline %}
                <div class="next-deadline">
                    <strong>⚡ Next Deadline:</strong> {{ deadline_summary.next_deadline.hours_remaining|round(1) }} hours until {{ deadline_summary.next_deadline.type.replace('_', ' ').title() }}
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Games Section -->
    <div class="games-section">
        {% if total_games == 0 %}
            <div class="no-games">
                <h3>No games available for Week {{ current_week }}</h3>
                <p>Games haven't been created yet for this week.</p>
            </div>
        {% else %}
            <h3>🎯 Select Your Picks</h3>
            <form method="POST" action="{{ url_for('submit_picks') }}" class="picks-form">
                {% for game in games %}
                    <div class="game-card">
                        <div class="game-header">
                            <strong>{{ get_team_name(game.away_team) }} @ {{ get_team_name(game.home_team) }}</strong>
                            <span class="game-date">{{ game.game_date.strftime('%a %m/%d %I:%M %p AST') if game.game_date else 'TBD' }}</span>
                            {% if game.is_actual_monday_night %}
                                <span class="monday-night-badge">🏈 Monday Night</span>
                            {% endif %}
                        </div>
                        
                        <div class="team-options">
                            <label class="team-option">
                                <input type="radio" 
                                       name="game_{{ game.id }}" 
                                       value="{{ game.away_team }}"
                                       {% if user_picks.get(game.id) and user_picks[game.id].selected_team == game.away_team %}checked{% endif %}>
                                <img src="{{ get_team_logo_url(game.away_team) }}" alt="{{ game.away_team }}" class="team-logo">
                                {{ get_team_name(game.away_team) }}
                            </label>
                            
                            <label class="team-option">
                                <input type="radio" 
                                       name="game_{{ game.id }}" 
                                       value="{{ game.home_team }}"
                                       {% if user_picks.get(game.id) and user_picks[game.id].selected_team == game.home_team %}checked{% endif %}>
                                <img src="{{ get_team_logo_url(game.home_team) }}" alt="{{ game.home_team }}" class="team-logo">
                                {{ get_team_name(game.home_team) }}
                            </label>
                        </div>
                        
                        {% if game.show_mnf_predictions %}
                        <div class="monday-night-scores">
                            <h4>Score Prediction (Required for Tiebreaker)</h4>
                            <div class="score-inputs">
                                <div class="score-input">
                                    <label for="away_score_{{ game.id }}">{{ get_team_name(game.away_team) }} Score:</label>
                                    <input type="number" 
                                           id="away_score_{{ game.id }}" 
                                           name="away_score_{{ game.id }}" 
                                           min="0" 
                                           max="99" 
                                           value="{{ user_picks.get(game.id, {}).get('predicted_away_score', '') }}">
                                </div>
                                <div class="score-input">
                                    <label for="home_score_{{ game.id }}">{{ get_team_name(game.home_team) }} Score:</label>
                                    <input type="number" 
                                           id="home_score_{{ game.id }}" 
                                           name="home_score_{{ game.id }}" 
                                           min="0" 
                                           max="99" 
                                           value="{{ user_picks.get(game.id, {}).get('predicted_home_score', '') }}">
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                {% endfor %}
                
                <div class="form-actions">
                    <button type="submit" class="submit-button">💾 Save All Picks</button>
                    <a href="{{ url_for('index') }}" class="back-button">← Back to Dashboard</a>
                </div>
            </form>
        {% endif %}
    </div>
</div>

<style>
.games-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* Dashboard Section */
.dashboard-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.welcome-header {
    text-align: center;
    margin-bottom: 30px;
}

.welcome-header h2 {
    color: #1e3a8a;
    margin-bottom: 10px;
}

.welcome-header p {
    color: #666;
    font-size: 1.1rem;
}

.stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-item {
    text-align: center;
    padding: 20px;
    background: #f8fafc;
    border-radius: 8px;
    border-left: 4px solid #3b82f6;
}

.stat-label {
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 5px;
}

.stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #1e3a8a;
    margin-bottom: 5px;
}

.stat-subtitle {
    font-size: 0.8rem;
    color: #666;
}

.progress-section {
    margin-bottom: 30px;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.9rem;
    color: #666;
}

.progress-bar {
    background: #e5e7eb;
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    background: #059669;
    height: 100%;
    transition: width 0.3s ease;
}

/* Deadline Section */
.deadline-summary h3 {
    color: #1e3a8a;
    margin-bottom: 15px;
}

.deadline-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
}

.deadline-card {
    background: #f8fafc;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #e5e7eb;
}

.deadline-card.warning {
    border-left-color: #f59e0b;
    background: #fffbeb;
}

.deadline-card.critical {
    border-left-color: #ef4444;
    background: #fef2f2;
}

.deadline-card.passed {
    border-left-color: #6b7280;
    background: #f9fafb;
    opacity: 0.7;
}

.deadline-type {
    font-weight: bold;
    color: #1e3a8a;
}

.deadline-time {
    font-size: 0.9rem;
    color: #666;
    margin: 5px 0;
}

.deadline-status {
    font-size: 0.8rem;
    font-weight: bold;
}

.deadline-card.warning .deadline-status {
    color: #f59e0b;
}

.deadline-card.critical .deadline-status {
    color: #ef4444;
}

.deadline-note {
    font-size: 0.8rem;
    font-style: italic;
    color: #666;
}

.deadline-matchup {
    font-size: 0.8rem;
    color: #666;
    margin-top: 5px;
}

.next-deadline {
    text-align: center;
    background: #dbeafe;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #3b82f6;
    grid-column: 1 / -1;
    color: #1e40af;
}

/* Games Section */
.games-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.games-section h3 {
    color: #1e3a8a;
    margin-bottom: 20px;
}

.no-games {
    text-align: center;
    padding: 40px;
    background: #f8f9fa;
    border-radius: 8px;
}

.game-card {
    background: #f8fafc;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.game-card:hover {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transform: translateY(-1px);
}

.game-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    font-size: 1.1rem;
    font-weight: bold;
    color: #1e3a8a;
}

.game-date {
    color: #666;
    font-size: 0.9rem;
    font-weight: normal;
}

.team-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.team-option {
    display: flex;
    align-items: center;
    padding: 12px;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.team-option:hover {
    border-color: #3b82f6;
    background: #eff6ff;
}

.team-logo {
    width: 24px;
    height: 24px;
    margin-right: 8px;
    object-fit: contain;
}

.team-option input[type="radio"]:checked + .team-logo + span,
.team-option input[type="radio"]:checked ~ .team-logo,
.team-option:has(input[type="radio"]:checked) {
    background: #dbeafe;
    border-color: #3b82f6;
    color: #1e40af;
}

.team-option input {
    margin-right: 10px;
}

.team-option input[type="radio"]:checked {
    accent-color: #3b82f6;
}

.team-option:has(input[type="radio"]:checked) {
    background: #dbeafe;
    border-color: #3b82f6;
    color: #1e40af;
}

/* Monday Night Football Styling */
.monday-night-badge {
    background: #dc2626;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
    margin-left: 10px;
}

.monday-night-scores {
    margin-top: 15px;
    padding: 15px;
    background: #fef3c7;
    border: 2px solid #f59e0b;
    border-radius: 8px;
}

.monday-night-scores h4 {
    margin: 0 0 10px 0;
    color: #92400e;
    font-size: 0.9rem;
}

.score-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.score-input {
    display: flex;
    flex-direction: column;
}

.score-input label {
    font-size: 0.85rem;
    font-weight: 500;
    color: #92400e;
    margin-bottom: 5px;
}

.score-input input {
    padding: 8px;
    border: 1px solid #d97706;
    border-radius: 4px;
    font-size: 1rem;
    text-align: center;
}

.score-input input:focus {
    outline: none;
    border-color: #f59e0b;
    box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
}

.team-option input:checked + .team-option {
    border-color: #059669;
    background: #ecfdf5;
}

.form-actions {
    margin-top: 30px;
    text-align: center;
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
}

.submit-button {
    background: #059669;
    color: white;
    padding: 15px 30px;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.submit-button:hover {
    background: #047857;
    transform: translateY(-2px);
}

.back-button {
    background: #6b7280;
    color: white;
    padding: 15px 30px;
    text-decoration: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.back-button:hover {
    background: #4b5563;
    transform: translateY(-2px);
}

/* Thursday Picks Revelation */
.picks-revelation-section {
    background: white;
    border-radius: 12px;
    padding: 30px;
    margin-top: 30px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.picks-revelation-section h3 {
    color: #1e3a8a;
    margin-bottom: 10px;
}

.revelation-subtitle {
    color: #666;
    margin-bottom: 20px;
    font-style: italic;
}

.game-picks-card {
    background: #f8fafc;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
}

.game-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    font-size: 1.1rem;
    font-weight: bold;
    color: #1e3a8a;
}

.picks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
}

.user-pick {
    background: white;
    padding: 10px 15px;
    border-radius: 6px;
    border-left: 4px solid #3b82f6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.username {
    font-weight: 600;
    color: #1e3a8a;
}

.selected-team {
    color: #666;
    font-size: 0.9rem;
}

.no-picks {
    color: #666;
    font-style: italic;
    text-align: center;
    padding: 20px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .games-container {
        padding: 15px;
    }
    
    .stats-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }
    
    .deadline-cards {
        grid-template-columns: 1fr;
    }
    
    .team-options {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .form-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .submit-button,
    .back-button {
        width: 100%;
        max-width: 300px;
    }
}
</style>

{% endblock %}
